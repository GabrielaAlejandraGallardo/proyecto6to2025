{% extends 'paginas_base/base.html' %}

{% block titulo %}Página Lista Cuota de Socios {% endblock titulo %}
{% block contenido %}
    <div class="card">
        <div class="card-header">
              <!-- Busca por nombre o código de socio -->  
      <form method="get" action="." class="form-inline" role="search" style="display:flex;gap:8px;align-items:center;">
          <input type="text" name="q" value="{{ query|default_if_none:'' }}" class="form-control" placeholder="Buscar por nombre del socio"/>
          <button type="submit" class="btn btn-secondary">Buscar</button>
      </form>
            <a name="btnuevo" id="btnuevo" class="btn btn-primary" href="{% url 'crear_editarSocioCuota' id=0  %}" role="button">Nuevo Cuota Socio</a>
        </div>
        <div class="card-body">
            <h4 class="card-title">Socios</h4>
            {{ SociosCuota|length }} 
      <table class="table">
    <thead>
        <tr>
            <th>Mes</th>
            <th>Nro. Registro</th>
            <th>Nombre</th>
            <th>Fecha de Pago</th>
            <th>Importe</th>
            <th>Estado</th>
            <th>WhatsApp</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for mes, lista_socios, total in pagos_y_totales %}
            {% for socio in lista_socios %}
            <tr>
                {% if forloop.first %}
                    <td rowspan="{{ lista_socios|length }}">{{ mes }}</td>
                {% endif %}
                <td>{{ socio.id }}</td>
                <td>{{ socio.nom }}</td>
                <td>{{ socio.fechap|default:"-" }}</td>
                <td>${{ socio.importe|default:"-" }}</td>
                <td>
                    {% if socio.estado == "Al día" %}
                        <span class="badge badge-success">{{ socio.estado }}</span>
                    {% else %}
                        <span class="badge badge-danger">{{ socio.estado }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if socio.telefono %}
                        <a class="btn btn-success btn-sm" href="https://wa.me/{{ socio.telefono }}" target="_blank">WhatsApp</a>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if socio.estado == "Al día" %}
                        <a class="btn btn-info" href="{% url 'crear_editarSocioCuota' id=socio.cuota_id %}">Editar</a>
                        <a class="btn btn-danger" href="{% url 'eliminarCuotaSocio' id=socio.cuota_id %}">Eliminar</a>
                    {% else %}
                        <a class="btn btn-primary" href="{% url 'crear_editarSocioCuota' id=0 %}?socio={{ socio.id }}">Registrar Pago</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td colspan="4" class="text-right"><strong>Total {{ mes }}:</strong></td>
                <td><strong>${{ total }}</strong></td>
                <td><strong>Pago Administrador (10%):</strong></td>
                <td><strong>${% widthratio total 10 1 %}</strong></td>
                <td></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
            
        </div>
        <div class="card-footer text-muted">
        
        </div>
    </div>
   
   

{% endblock contenido %}
